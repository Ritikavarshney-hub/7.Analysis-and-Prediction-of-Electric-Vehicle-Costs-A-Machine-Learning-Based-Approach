<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Charging Station Locator</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/charging_locator.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <h1>ðŸ”Œ EV Charging Station Locator</h1>

    <!-- Search Form -->
    <form method="GET" action="/charging-locator">
        <label for="address">Enter Location:</label>
        <input type="text" name="address" id="address" value="{{ address or '' }}" placeholder="City or Address" required>

        <label for="radius">Search Radius (km):</label>
        <select name="radius" id="radius">
            <option value="5" {% if radius == '5' %}selected{% endif %}>5 km</option>
            <option value="10" {% if radius == '10' %}selected{% endif %}>10 km</option>
            <option value="20" {% if radius == '20' %}selected{% endif %}>20 km</option>
            <option value="50" {% if radius == '50' %}selected{% endif %}>50 km</option>
        </select>

        <button type="submit">Find Stations</button>
    </form>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Station List -->
    {% if stations %}
    <div class="station-list">
        <h2>Nearby Charging Stations</h2>
        {% for station in stations %}
        <div class="station-item">
            <strong>{{ station.title }}</strong><br>
            {{ station.address }}, {{ station.town }}<br>
            {{ station.state }} {{ station.postcode }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='js/charging_locator.js') }}"></script>
    <script>
        const stations = {{ stations | tojson | safe }};
        {% if lat and lon %}
        const map = initMap({{ lat }}, {{ lon }});
        plotStations(map, stations);
        {% else %}
        const map = initMap(); // default map
        {% endif %}
    </script>
</body>
</html>
